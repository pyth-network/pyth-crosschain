use libsecp256k1::SecretKey;
use test_vaas::{
    print_as_array_and_last, re_sign_price_update, u256_to_be, DataSource, GuardianSet,
};

fn main() {
    let secret1 = "047f10198517025e9bf2f6d09ebb650826b35397f01ca2a64a38348cae653f86";
    // address1 = 0x686b9ea8e3237110eaaba1f1b7467559a3273819

    let secret2 = "a95d32e5e2b9464b3f49a0f7ef2ede3ff17585836b253b96c832a86d2b5614cb";
    // address2 = 0x363598f080a817e633fc2d8f2b92e6e637f8b449

    let guardians = GuardianSet {
        set_index: 0,
        secrets: vec![SecretKey::parse_slice(&hex::decode(secret1).unwrap()).unwrap()],
    };

    let guardians2 = GuardianSet {
        set_index: 1,
        secrets: vec![SecretKey::parse_slice(&hex::decode(secret2).unwrap()).unwrap()],
    };

    let data = [
        "504e41550100000003b801000000040d005320dd51d28e0cf68194b22a752470c331df400572b0ca981e34e7d00febfa1121c18ef67a0407fec72db62cdd96222a88bbbcffa93b027f610415302c96de1b00028be7fac9d4a0f3bd207b5791c8b79bec28444c00866191710264b44b57ca5ffe78c82a73bdc9f2beaeb99376bca5d1cb2a5680dead59271ad92823dd94ad1a550103b6fdd034183a36cbcdf347854315ab3b1433a7e701f86c19ba7e60bb36aac3c073ffde73fe4215780c891e15918833a423dde9facce4ec4067c21431c3dd4e110004fa2a06375fea37513caf730e24acd5a51c60bd430938963e436feb8e16ab670419040b5587d12c73b50673e7b963abb927a764671654760946ed01eef411eab9010600aeb3f7e650ce14572204b740de60d3854af67ec619a1d3167c79051a311eed7488f33561c80ba96e67033ff3648a553c4776020eb4f9a3af42251ee000e71300070640f3a0789ba8b70ee0b74e18099f9d22ee9194cace268fc9976dbcdfbcd45163dbab0de5cdd530e0047c27d6d3c30e306234d91c58da5f4f89179ba19d07b5000bd6ef9e47ee571f6373e3111f140fef8368e650c01276c8f1184e6e5928eb0ad670a31d512b7bf60d990ef25c6d4786b24dd3d71001d3301e04b671a16b011dae000ccaab09d4a142d240a500e2e427a3a1eedbbbafb38ab5175bd67beea6f1016f221ca4d47be4689aaa19cdcc844624d43d59786a56f305de5f4672bd5f7701bc50010dbf778eb450a84295bf0601c21a2e136f33f95094d560e268861730573a55bfbe2a460498af433ae0d697c6c0e67a018684305faa05046d3a223c83f44f01cd5c010e1bd1dabe6e765fd5336157a6f927caa63c1538b9a323c6dc106aa4ed08b590ab3b42dcd92ecf1e016ee9c7e0482d199d98fd918cd3e9b3da7f405bfb1e9796da010f8e2b4b0a9a68ac00c0afe3d85390718d4eaca5f46c0fa57a2502774bfa24232813b542ca615987bdd1a9f46205ef5e7d21a4218ea77fe57b2aee6964bbec5b030010e1f9798036c3b17a5ce3b20a2bba3abc7683daeff6879f971bc8419ab45bab7618ff9b00a75cb1a047a241b177c98da8aedf2e6d5600cac0df474c1a73c4f8530012afb324617a35a631e904f7b53c3683f002936668f719c0c406a92141470fc30567453771501e37c0f25eb7d36e790b9e0d14aa2c502be01c73e6c680cec45d97006644907f00000000001ae101faedac5851e32b9b23b5f9411a8c2bac4aae3ed4dd7b811dd1a72ea4aa710000000003611faa01415557560000000000086b3d2c0000271079b5cb7d4c7e1c85556ad969e75614b8a272383701005500e62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43000005b66c59a10000000000b8c11371fffffff8000000006644907e000000006644907e000005ae1b11cdc000000000bccb64b80a266a8aa8ed85761b2716dec7ff80ca93d6463616aaaa0083c4f5764c15cf3da1fd27d31ba71e9b87ad7fdb966c073f4a13e3bb2f0fad258c22041e2edf87f279e6e9570c5376bb170044ed9c4b7989793410368db52de5774bfdd9fb1a182cd1b4c59eb0b84f78d9fbaf9e60dbebb48b23e013799ed36b4a1aa2a98fe3533275198c97d48f3139e5e688c926a9975244315131ee0078e847daa0bda876e1a509c7b8afe9888696b49f424641e6cb2d271576948a8428030d171c3f67fd1dd9ba62fe1a464b7849c2",
        "504e41550100000003b801000000040d0078c1c39cc9036ff5b77ab57320c9063446902ca4d8a093eac4f483b58897fdea6ace38344d5b1beb85830c4c6ce6a1069587fe465d90b04baa3e7b31d9d4bf1401019bd155786ca5ba0b0892d6deb4652ee4807e524dde320ef786ae87005bffd319343d4c5fb73a1a37bc070b7b5701efdf5a1d30758aa6501abaa3538a971c1a6e0102e6ac44fc5c5475a791df7b6894993308fc73b760f6386cca37181504b4c981c1427cf9075b396b014d28471dc9a127097e43f7aa3d84253de55f28fbdc0c1e6400035e5570e94a512303d5e6a2fcad70e894a49422a9aae0f33d3b3c817a3a481f3b0e83d84052a1adc88bb5c4e9f243c1cac659aef7f91afd3c8d8345a26632b7480104a605e54eb1aadf738cfa6738e7f8e33cc8c7de75a095165302e3ab531eb5320c09e43454a0fbd6ae73465fd5d74933eba5500c089d65af9cb82ad171f63fae44000625c6f3ec9d903240d136ea1f401f815e559eee6ae0e1b64ccb458fc1e988b8b57ea91188d806a331b47a63de6a2669fb3efc683f5a3a59b5ad56523b46593f0a0107f0fea4b0113f2890ea9214a5cf306c44d6c6c411b26683d9ef29a001a1ec7f211e5a30aab07feddc488c2b7dfeccddd03a95786571899a5b329e813d997b5ded010b6a8542ebe7bfd20893ae6fcba2d9e1c10ffeada79f5bc98fa12cc81b773916780d1c48110065ece3647763c78e995447d691b298630fce719ba5a9bf06b667af000c776d09592a76644442801fd127ed93cc2eef0c7091a15befca05b5896acb19b376bf3499a30b2bf1e4728024fb38ab907e719523e7b61119d93e90686a94550e000ddf0fbecc9dba2b7487ed62bdd78a099aa20c587bfd8a73ac1e7ef344e7cfe5fb4ba92c20f174ac66ecd64b6cf994bf34b6d6cee6582bbaaf14b6a870078de96b000e19479568bb774e1a0b4b985c00e7747c70067daa96ab44008c86784b8b0ee6c729d0632003f9343730a452f359029a0961a260003d8d75245f0c8aa3db23023f010f1ebefdcd36a2fd6b72ce8fabe9e9e16ede44ef2b1c5179a4e44c0ca3a7b24cf03dcee54d90b28fd21dd649581616348565ad30d53fffc75a804bc25b29a85efb0112ca92c3b2c08afc49c7fc49c6678735563c6b3b5fc199ff70c951adb94dfaec0659d0543073a69ab1a8dd46be673af96fafd0c65d83ebfa274239dc7c383ac4c9016644908400000000001ae101faedac5851e32b9b23b5f9411a8c2bac4aae3ed4dd7b811dd1a72ea4aa710000000003611fb601415557560000000000086b3d38000027102c9a35a044ed7becf6fb4d92621d48a930c5b0c501005500e62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43000005b687eb22a900000000d0458627fffffff800000000664490830000000066449083000005ae1e43acc000000000bccb05040adf16c33ea64586472be0d01955ca53f009516b22cad85d8fa0255b15c4f0381b21c92f9861976eeb6fb48d0916e7b5d9c84c96f2f55b8ddee8292b5f737aa48b71bcf5cde935ad180852b00eb9689e4ce50ac2aaa85a2aa42c0d9573b8cc46f9518279e5f5681cd7449ac980c550e409242667480c8e9f3c9ea6a43d7d5a0f1b1969a81e3bf9fa0ea613fb4ef01ab0d7d1e587223a510e17061f9a29a8f52c64fb219556a265c5026844792da87ff3bc59b913bc16a56bd50680b342bd86a51640f9161ebcaa17ca",
    ];
    for (index, item) in data.into_iter().enumerate() {
        println!("update #{}:", index + 1);
        let data = re_sign_price_update(&hex::decode(item).unwrap(), &guardians, None);
        print_as_array_and_last(&data);
        println!();
    }

    println!("update #2 with alt emitter:");
    let update2_alt_emitter = re_sign_price_update(
        &hex::decode(data[1]).unwrap(),
        &guardians,
        Some(DataSource {
            emitter_chain_id: 3,
            emitter_address: u256_to_be(301.into()).into(),
        }),
    );
    print_as_array_and_last(&update2_alt_emitter);

    println!("update #2 with test2 guardian:");
    let update2_test2_guardian =
        re_sign_price_update(&hex::decode(data[1]).unwrap(), &guardians2, None);
    print_as_array_and_last(&update2_test2_guardian);
    println!();
}
