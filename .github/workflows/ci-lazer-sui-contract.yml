name: "Lazer Sui contract test"
on:
  push:
    branches:
      - main
  pull_request:
    paths:
      - lazer/contracts/sui/**
      - .github/workflows/ci-lazer-sui-contract.yml

jobs:
  lazer-sui-contract-test:
    name: Lazer Sui contract test
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: lazer/contracts/sui/
    steps:
      - uses: actions/checkout@v4
      - name: Download Sui CLI binary
        run: |
          set -euo pipefail
          SUI_VERSION="1.30.0"
          ARCHIVE="sui-ubuntu-x86_64-${SUI_VERSION}.tgz"
          URL="https://github.com/MystenLabs/sui/releases/download/cli-v${SUI_VERSION}/${ARCHIVE}"
          curl -L -o "$ARCHIVE" "$URL"
          tar -xzf "$ARCHIVE"
          sudo mv sui /usr/local/bin/sui
          sui --version
      - name: Run tests
        run: sui move test
